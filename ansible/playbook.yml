---

- hosts: 'python'
  tasks:
    - name: "Pull Image from DockerHub"
      become: "yes"
      docker_image:
        name: "{{ docker_image_name }}"
        path: "{{ flask_directory }}"
        source: "pull"
    - name: "Create app directory if needed"
      file: "path={{ flask_directory }} state=directory"
    - name: "copy docker-compose to app's server"
      copy:
        src: "{{ docker_compose_dir }}"
        dest: "{{ flask_directory }}"
        owner: "ubuntu"
        group: "ubuntu"
        mode: '0644'
    - name: "Up docker compose"
      command: "docker-compose up -f {{ flask_directory }}/docker-compose.yml -d"
